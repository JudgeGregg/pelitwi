<!DOCTYPE html>
<html lang="en">
<head>
          <title>Test Pelican - Twisted Pair: Device Configuration</title>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />

        <meta name="Description" content="An event-driven networking engine written in Python and MIT licensed." />

        <link rel="stylesheet" type="text/css" href="https://judgegregg.github.io/pelitwi/theme/css/twistedtrac.css" />


</head>

<body>
        <div id="banner">
                <div id="top_grad"></div>
                <div id="tab">
                        <a href="https://twistedmatrix.com/trac/wiki">HOME</a>
                        <a href="https://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions">FAQ</a>
                        <a href="/">DOCS</a>
                        <a href="https://twistedmatrix.com/trac/wiki/Downloads">DOWNLOAD</a>
                </div>

                <div id="header">
                        <a id="logo" href="https://judgegregg.github.io/pelitwi/"><img src="https://judgegregg.github.io/pelitwi/theme/images/trac_banner.png" alt="Twisted" /></a>
                </div>
        </div>

<div id="mainnav" class="related">
	<ul>
		<li><a href="https://judgegregg.github.io/pelitwi">Twisted 21.2.0 documentation</a> Â»</li>
	</ul>
</div>
        <div id="ctxtnav" class="nav">
        </div>

    <section>

    <div class="document">
        <div class="documentwrapper">
        <div class="bodywrapper">
        <h1>Twisted Pair: Device Configuration</h1>
        
        <div class="entry-content">
        <p>Certain system configuration is required before the full Twisted Pair test suite can be run.
Without this setup the test suite will lack the permission necessary to access tap and tun devices.
Some tests will still run but the integration tests which verify Twisted Pair can successfully read from and write to real devices will be skipped.</p>
<p>The following shell script creates two tun devices and two tap devices and grants permission to use them to whatever user the shell script is run as.
Run it to configure your system so that you can perform a complete run of the Twisted Pair test suite.</p>
<div class="highlight"><pre><span></span><span class="gp"># </span>Needs to be short enough so that with prefix and suffix, fits into <span class="m">16</span> bytes
<span class="go">IDENTIFIER=&quot;twtest&quot;</span>

<span class="gp"># </span>A tap device without protocol information
<span class="go">sudo ip tuntap add dev tap-${IDENTIFIER} mode tap user $(id -u -n) group $(id -g -n)</span>
<span class="go">sudo ip link set up dev tap-${IDENTIFIER}</span>
<span class="go">sudo ip addr add 172.16.0.1/24 dev tap-${IDENTIFIER}</span>
<span class="go">sudo ip neigh add 172.16.0.2 lladdr de:ad:be:ef:ca:fe dev tap-${IDENTIFIER}</span>

<span class="gp"># </span>A tap device with protocol information
<span class="go">sudo ip tuntap add dev tap-${IDENTIFIER}-pi mode tap user $(id -u -n) group $(id -g -n) pi</span>
<span class="go">sudo ip link set up dev tap-${IDENTIFIER}-pi</span>
<span class="go">sudo ip addr add 172.16.1.1/24 dev tap-${IDENTIFIER}-pi</span>
<span class="go">sudo ip neigh add 172.16.1.2 lladdr de:ad:ca:fe:be:ef dev tap-${IDENTIFIER}-pi</span>

<span class="gp"># </span>A tun device without protocol information
<span class="go">sudo ip tuntap add dev tun-${IDENTIFIER} mode tun user $(id -u -n) group $(id -g -n)</span>
<span class="go">sudo ip link set up dev tun-${IDENTIFIER}</span>

<span class="gp"># </span>A tun device with protocol information
<span class="go">sudo ip tuntap add dev tun-${IDENTIFIER}-pi mode tun user $(id -u -n) group $(id -g -n) pi</span>
<span class="go">sudo ip link set up dev tun-${IDENTIFIER}-pi</span>
</pre></div>
<p>There are two things to keep in mind about this configuration.
First, it uses addresses from the 172.16.0.0/12 private use range.
If your network is configured to use these already then running the script may cause problems for your network.
These addresses are hard-coded into the Twisted Pair test suite so this problem is not easily avoided.
Second, the changes are not persistent across reboots.
If you want this network configuration to be available even after a reboot you will need to integrate the above into your system's init scripts somehow
(the details of this for different systems is beyond the scope of this document).</p>
<p>Certain platforms may also require a modification to their firewall rules in order to allow the traffic the test suite wants to transmit.
Adding firewall rules which allowing traffic destined for the addresses used by the test suite should address this problem.
If you encounter timeouts when running the Twisted Pair test suite then this may apply to you.
For example, to configure an iptables firewall to allow this traffic:</p>
<pre class="literal-block">
iptables -I INPUT --dest 172.16.1.1 -j ACCEPT
iptables -I INPUT --dest 172.16.2.1 -j ACCEPT
</pre>

        </div>
        </div>
        </div>
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
</div>
</div>    </div>

    </section>

        <div id="footer"><hr>
                <div> </div>
                <p class="left2">
        Copyright 2021, Twisted Matrix Labs. Ver 21.2.0. Built on 2021-02-28.<br />
        Site design<br />
        By <a href="http://huw.ugbox.net/">huw.wilkins.</a>

                </p>
                <p class="right"></p>
        </div>


</body>
</html>