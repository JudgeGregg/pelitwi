<!DOCTYPE html>
<html lang="en">
<head>
          <title>Test Pelican - Access Logging</title>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />

        <meta name="Description" content="An event-driven networking engine written in Python and MIT licensed." />

        <link rel="stylesheet" type="text/css" href="https://judgegregg.github.io/pelitwi/theme/css/twistedtrac.css" />


</head>

<body>
        <div id="banner">
                <div id="top_grad"></div>
                <div id="tab">
                        <a href="https://twistedmatrix.com/trac/wiki">HOME</a>
                        <a href="https://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions">FAQ</a>
                        <a href="/">DOCS</a>
                        <a href="https://twistedmatrix.com/trac/wiki/Downloads">DOWNLOAD</a>
                </div>

                <div id="header">
                        <a id="logo" href="https://judgegregg.github.io/pelitwi/"><img src="https://judgegregg.github.io/pelitwi/theme/images/trac_banner.png" alt="Twisted" /></a>
                </div>
        </div>

<div id="mainnav" class="related">
	<ul>
		<li><a href="https://judgegregg.github.io/pelitwi">Twisted 21.2.0 documentation</a> Â»</li>
	</ul>
</div>
        <div id="ctxtnav" class="nav">
        </div>

    <section>

    <div class="document">
        <div class="documentwrapper">
        <div class="bodywrapper">
        <h1>Access Logging</h1>
        
        <div class="entry-content">
        <p>As long as we're on the topic of <a class="reference external" href="https://judgegregg.github.io/pelitwi/pages/logging-errors.html">logging</a>, this is probably a good time to mention Twisted Web's access log support.
In this example, we'll see what Twisted Web logs for each request it processes and how this can be customized.</p>
<p>If you've run any of the previous examples and watched the output of <tt class="docutils literal">twistd</tt> or read <tt class="docutils literal">twistd.log</tt> then you've already seen some log lines like this:</p>
<blockquote>
2014-01-29 17:50:50-0500 [HTTPChannel,0,127.0.0.1] &quot;127.0.0.1&quot; - - [29/Jan/2014:22:50:50 +0000] &quot;GET / HTTP/1.1&quot; 200 2753 &quot;-&quot; &quot;Mozilla/5.0 ...&quot;</blockquote>
<p>If you focus on the latter portion of this log message you'll see something that looks like a standard &quot;combined log format&quot; message.
However, it's prefixed with the normal Twisted logging prefix giving a timestamp and some protocol and peer addressing information.
Much of this information is redundant since it is part of the combined log format.
<cite>Site &lt;twisted.web.server.Site&gt;</cite> lets you produce a more compact log which omits the normal Twisted logging prefix.
To take advantage of this feature all that is necessary is to tell <cite>Site &lt;twisted.web.server.Site&gt;</cite> where to write this compact log.
Do this by passing <tt class="docutils literal">logPath</tt> to the initializer:</p>
<div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">Site</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">logPath</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;/tmp/access-logging-demo.log&quot;</span><span class="p">)</span>
</pre></div>
<p>Or if you want to change the logging behavior of a server you're launching with <tt class="docutils literal">twistd web</tt> then just pass the <tt class="docutils literal"><span class="pre">--logfile</span></tt> option:</p>
<div class="highlight"><pre><span></span>$ twistd -n web --logfile /tmp/access-logging-demo.log
</pre></div>
<p>Apart from this, the rest of the server setup is the same.
Once you pass <tt class="docutils literal">logPath</tt> or use <tt class="docutils literal"><span class="pre">--logfile</span></tt> on the command line the server will produce a log file containing lines like:</p>
<blockquote>
&quot;127.0.0.1&quot; - - [30/Jan/2014:00:13:35 +0000] &quot;GET / HTTP/1.1&quot; 200 2753 &quot;-&quot; &quot;Mozilla/5.0 ...&quot;</blockquote>
<p>Any tools expecting combined log format messages should be able to work with these log files.</p>
<p><cite>Site &lt;twisted.web.server.Site&gt;</cite> also allows the log format used to be customized using its <tt class="docutils literal">logFormatter</tt> argument.
Twisted Web comes with one alternate formatter, <cite>proxiedLogFormatter &lt;twisted.web.http.proxiedLogFormatter&gt;</cite>, which is for use behind a proxy that sets the <tt class="docutils literal"><span class="pre">X-Forwarded-For</span></tt> header.
It logs the client address taken from this header rather than the network address of the client directly connected to the server.
Here's the complete code for an example that uses both these features:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.web.http</span> <span class="kn">import</span> <span class="n">proxiedLogFormatter</span>
<span class="kn">from</span> <span class="nn">twisted.web.server</span> <span class="kn">import</span> <span class="n">Site</span>
<span class="kn">from</span> <span class="nn">twisted.web.static</span> <span class="kn">import</span> <span class="n">File</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">endpoints</span>

<span class="n">resource</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s1">&#39;/tmp&#39;</span><span class="p">)</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">Site</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">logPath</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;/tmp/access-logging-demo.log&quot;</span><span class="p">,</span> <span class="n">logFormatter</span><span class="o">=</span><span class="n">proxiedLogFormatter</span><span class="p">)</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="o">.</span><span class="n">TCP4ServerEndpoint</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="mi">8888</span><span class="p">)</span>
<span class="n">endpoint</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

        </div>
        </div>
        </div>
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
</div>
</div>    </div>

    </section>

        <div id="footer"><hr>
                <div> </div>
                <p class="left2">
        Copyright 2021, Twisted Matrix Labs. Ver 21.2.0. Built on 2021-02-28.<br />
        Site design<br />
        By <a href="http://huw.ugbox.net/">huw.wilkins.</a>

                </p>
                <p class="right"></p>
        </div>


</body>
</html>