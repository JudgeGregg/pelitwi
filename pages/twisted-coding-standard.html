<!DOCTYPE html>
<html lang="en">
<head>
          <title>Test Pelican - Twisted Coding Standard</title>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />

        <meta name="Description" content="An event-driven networking engine written in Python and MIT licensed." />

        <link rel="stylesheet" type="text/css" href="https://judgegregg.github.io/pelitwi/theme/css/twistedtrac.css" />


</head>

<body>
        <div id="banner">
                <div id="top_grad"></div>
                <div id="tab">
                        <a href="https://twistedmatrix.com/trac/wiki">HOME</a>
                        <a href="https://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions">FAQ</a>
                        <a href="/">DOCS</a>
                        <a href="https://twistedmatrix.com/trac/wiki/Downloads">DOWNLOAD</a>
                </div>

                <div id="header">
                        <a id="logo" href="https://judgegregg.github.io/pelitwi/"><img src="https://judgegregg.github.io/pelitwi/theme/images/trac_banner.png" alt="Twisted" /></a>
                </div>
        </div>

<div id="mainnav" class="related">
	<ul>
		<li><a href="https://judgegregg.github.io/pelitwi">Twisted 21.2.0 documentation</a> Â»</li>
	</ul>
</div>
        <div id="ctxtnav" class="nav">
        </div>

    <section>

    <div class="document">
        <div class="documentwrapper">
        <div class="bodywrapper">
        <h1>Twisted Coding Standard</h1>
        
        <div class="entry-content">
        <div class="section" id="naming">
<h2><a class="toc-backref" href="#id2">Naming</a></h2>
<p>Try to choose names which are both easy to remember and meaningful.
Some silliness is OK at the module naming level (see <cite>twisted.spread</cite> ...) but when choosing class names, be as precise as possible.</p>
<p>Try to avoid terms that may have existing definitions or uses.
This rule is often broken, since it is incredibly difficult, as most normal words have already been taken by some other software.
As an example, using the term "reactor" elsewhere in Twisted for something that is not an implementor of <tt class="docutils literal">IReactor</tt> adds additional meaning to the word and will cause confusion.</p>
<p>More importantly, try to avoid meaningless words.
In particular, words like "handler", "processor", "engine", "manager", and "component" don't really indicate what something does, only that it does <em>something</em>.</p>
<p>Use American spelling in both names and docstrings.
For compound technical terms such as 'filesystem', use a non-hyphenated spelling in both docstrings and code in order to avoid unnecessary capitalization.</p>
</div>
<div class="section" id="testing">
<h2><a class="toc-backref" href="#id3">Testing</a></h2>
<div class="section" id="overview">
<h3><a class="toc-backref" href="#id4">Overview</a></h3>
<p>Twisted development should always be <a class="reference external" href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven</a> .
The complete test suite in the head of the Git trunk is required to be passing on <a class="reference external" href="https://buildbot.twistedmatrix.com/supported">supported platforms</a> at all times.
Regressions in the test suite are addressed by reverting whatever revisions introduced them.</p>
</div>
<div class="section" id="test-suite">
<h3><a class="toc-backref" href="#id5">Test Suite</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference external" href="https://judgegregg.github.io/pelitwi/pages/unit-tests-in-twisted.html">test standard</a> contains more in-depth information on this topic.
What follows is intended to be a synopsis of the most important points.</p>
</div>
<p>The Twisted test suite is spread across many subpackages of the <tt class="docutils literal">twisted</tt> package.
Many older tests are in <tt class="docutils literal">twisted.test</tt> .
Others can be found at places such as <tt class="docutils literal">twisted.web.test</tt> (for <tt class="docutils literal">twisted.web</tt> tests) or <tt class="docutils literal">twisted.internet.test</tt> (for <tt class="docutils literal">twisted.internet</tt> tests).
The latter arrangement, <tt class="docutils literal">twisted.somepackage.test</tt>, is preferred for new tests except when a test module already exists in <tt class="docutils literal">twisted.test</tt> .</p>
<p>Parts of the Twisted test suite may serve as good examples of how to write tests for Twisted or for Twisted-based libraries (newer parts of the test suite are generally better examples than older parts - check when the code you are looking at was written before you use it as an example of what you should write).
The names of test modules must begin with <tt class="docutils literal">test_</tt> so that they are automatically discoverable by test runners such as Trial.
Twisted's unit tests are written using <cite>twisted.trial</cite>, an xUnit library which has been extensively customized for use in testing Twisted and Twisted-based libraries.</p>
<p>Implementation (i.e., non-test) source files should begin with a <tt class="docutils literal"><span class="pre">test-case-name</span></tt> tag which gives the name of any test modules or packages which exercise them.
This lets tools discover a subset of the entire test suite which they can run first to find tests which might be broken by a particular change.</p>
<p>All unit test methods should have docstrings specifying at a high level the intent of the test.
That is, a description that users of the method would understand.</p>
<p>If you modify, or write a new, HOWTO, please read the <a class="reference external" href="https://judgegregg.github.io/pelitwi/pages/twisted-writing-standard.html">documentation writing standard</a>.</p>
</div>
</div>
<div class="section" id="copyright-header">
<h2><a class="toc-backref" href="#id6">Copyright Header</a></h2>
<p>Whenever a new file is added to the repository, add the following license header at the top of the file:</p>
<div class="highlight"><pre><span></span><span class="c1"># Copyright (c) Twisted Matrix Laboratories.</span>
<span class="c1"># See LICENSE for details.</span>
</pre></div>
<p>When you update existing files, if there is no copyright header, add one.</p>
</div>
<div class="section" id="whitespace">
<h2><a class="toc-backref" href="#id7">Whitespace</a></h2>
<p>Code must be formatted according to the <a class="reference external" href="https://github.com/psf/black/blob/master/docs/the_black_code_style.md">The Black Code Style</a>.
This entire source tree can be reformatted by running:</p>
<div class="highlight"><pre><span></span><span class="go">tox -e lint</span>
</pre></div>
<p>Only changed files can be reformatted by running:</p>
<div class="highlight"><pre><span></span><span class="go">pipx run pre-commit run</span>
</pre></div>
</div>
<div class="section" id="modules">
<h2><a class="toc-backref" href="#id8">Modules</a></h2>
<p>Modules must be named in all lower-case, preferably short, single words.
If a module name contains multiple words, they may be separated by underscores or not separated at all.</p>
<p>Modules must have a copyright message, a docstring, and a reference to a test module that contains the bulk of its tests.
New modules must have the <tt class="docutils literal">absolute_import</tt>, <tt class="docutils literal">division</tt>, and optionally the <tt class="docutils literal">print_function</tt> imports from the <tt class="docutils literal">__future__</tt> module.</p>
<p>Use this template:</p>
<p><cite>new_module_template.py &lt;../listings/new_module_template.py&gt;</cite></p>
<p>In most cases, modules should contain more than one class, function, or method; if a module contains only one object, consider refactoring to include more related functionality in that module.</p>
<p>Depending on the situation, it is acceptable to have imports that look like this:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet.defer</span> <span class="kn">import</span> <span class="n">Deferred</span>
</pre></div>
<p>or like this:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span>
</pre></div>
<p>That is, modules should import <em>modules</em> or <em>classes and functions</em>, but not <em>packages</em>.</p>
<p>Wildcard import syntax may not be used by code in Twisted.
These imports lead to code which is difficult to read and maintain by introducing complexity which strains human readers and automated tools alike.
If you find yourself with many imports to make from a single module and wish to save typing, consider importing the module itself, rather than its attributes.</p>
<p><em>Relative imports</em> (or <em>sibling imports</em>) may not be used by code in Twisted.
Relative imports allow certain circularities to be introduced which can ultimately lead to unimportable modules or duplicate instances of a single module.
Relative imports also make the task of refactoring more difficult.</p>
<p>In case of local names conflicts due to import, use the <tt class="docutils literal">as</tt> syntax, for example:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.trial</span> <span class="kn">import</span> <span class="n">util</span> <span class="k">as</span> <span class="n">trial_util</span>
</pre></div>
<p>The encoding must always be ASCII, so no coding cookie is necessary.</p>
</div>
<div class="section" id="packages">
<h2><a class="toc-backref" href="#id9">Packages</a></h2>
<p>Package names follow the same conventions as module names.
All modules must be encapsulated in some package.
Nested packages may be used to further organize related modules.</p>
<p><tt class="docutils literal">__init__.py</tt> must never contain anything other than a docstring and (optionally) an <tt class="docutils literal">__all__</tt> attribute.
Packages are not modules and should be treated differently.
This rule may be broken to preserve backwards compatibility if a module is made into a nested package as part of a refactoring.</p>
<p>If you wish to promote code from a module to a package, for example, to break a large module out into several smaller files, the accepted way to do this is to promote from within the module.
For example,</p>
<div class="highlight"><pre><span></span><span class="c1"># parent/</span>
<span class="c1"># --- __init__.py ---</span>
<span class="kn">import</span> <span class="nn">child</span>

<span class="c1"># --- child.py ---</span>
<span class="kn">import</span> <span class="nn">parent</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="n">parent</span><span class="o">.</span><span class="n">Foo</span> <span class="o">=</span> <span class="n">Foo</span>
</pre></div>
<p>Packages must not depend circularly upon each other.
To simplify maintaining this state, packages must also not import each other circularly.
While this applies to all packages within Twisted, one <tt class="docutils literal">twisted.python</tt> deserves particular attention, as it may not depend on any other Twisted package.</p>
</div>
<div class="section" id="strings">
<h2><a class="toc-backref" href="#id10">Strings</a></h2>
<p>All strings in Twisted which are not interfacing directly with Python (e.g. <tt class="docutils literal">sys.path</tt> contents, module names, and anything which returns <tt class="docutils literal">str</tt> on both Python 2 and 3)  should be marked explicitly as "bytestrings" or "text/Unicode strings".
This is done by using the <tt class="docutils literal">b</tt> (for bytestrings) or <tt class="docutils literal">u</tt> (for Unicode strings) prefixes when using string literals.
String literals not marked with this are "native/bare strings", and have a different meaning on Python 2 (where a bare string is a bytestring) and Python 3 (where a bare string is a Unicode string).</p>
<div class="highlight"><pre><span></span><span class="sa">u</span><span class="s2">"I am text, also known as a Unicode string!"</span>
<span class="sa">b</span><span class="s2">"I am a bytestring!"</span>
<span class="s2">"I am a native bare string, and therefore may be either!"</span>
</pre></div>
<p>Bytestrings and text must not be implicitly concatenated, as this causes an invisible ASCII encode/decode on Python 2, and causes an exception on Python 3.</p>
<p>Use <tt class="docutils literal">+</tt> to combine bytestrings, not string formatting (either "percent formatting" or <tt class="docutils literal">.format()</tt>).</p>
<div class="highlight"><pre><span></span><span class="n">HTTPVersion</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">"1.1"</span>
<span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">"HTTP/"</span> <span class="o">+</span> <span class="n">HTTPVersion</span><span class="p">)</span>
</pre></div>
<p>Utilities are available in <cite>twisted.python.compat</cite> to paper over some use cases where other Python code (especially the standard library) expects a "native string", or provides a native string where a bytestring is actually required (namely <cite>twisted.python.compat.nativeString &lt;twisted.python.compat&gt;</cite> and <cite>twisted.python.compat.networkString &lt;twisted.python.compat&gt;</cite>)</p>
<div class="section" id="string-formatting-operations">
<h3><a class="toc-backref" href="#id11">String Formatting Operations</a></h3>
<p>When using "percent formatting", you should always use a tuple if you're using non-mapping <tt class="docutils literal">values</tt>.
This is to avoid unexpected behavior when you think you're passing in a single value, but the value is unexpectedly a tuple, e.g.:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">"Hi </span><span class="si">%s</span><span class="se">\n</span><span class="s2">"</span> <span class="o">%</span> <span class="n">x</span>
</pre></div>
<p>The example shows you can pass in <tt class="docutils literal"><span class="pre">foo("foo")</span></tt> or <tt class="docutils literal">foo(3)</tt> fine, but if you pass in <tt class="docutils literal"><span class="pre">foo((1,2))</span></tt>, it raises a <tt class="docutils literal">TypeError</tt>.
You should use this instead:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">"Hi </span><span class="si">%s</span><span class="se">\n</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,)</span>
</pre></div>
</div>
</div>
<div class="section" id="docstrings">
<h2><a class="toc-backref" href="#id12">Docstrings</a></h2>
<p>Docstrings should always be used to describe the purpose of methods, functions, classes, and modules.
Moreover, all methods, functions, classes, and modules must have docstrings.
In addition to documenting the purpose of the object, the docstring must document all of parameters or attributes of the object.</p>
<p>When documenting a class with one or more attributes which are initialized directly from the value of a <tt class="docutils literal">__init__</tt> argument by
the same name (or differing only in that the attribute is private), it is sufficient to document the <tt class="docutils literal">__init__</tt> parameter (in the <tt class="docutils literal">__init__</tt> docstring).
For example:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Ninja</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    @ivar speed: See L{__init__}</span>
<span class="sd">    @ivar _stealth: See C{stealth} parameter of L{__init__}</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">stealth</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        @param speed: The maximum rate at which this ninja can travel (m/s)</span>
<span class="sd">        @type speed: L{int} or L{float}</span>

<span class="sd">        @param stealth: This ninja's ability to avoid being noticed in its</span>
<span class="sd">            activities, as a percentage modifier.</span>
<span class="sd">        @type: L{int}</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stealth</span> <span class="o">=</span> <span class="n">stealth</span>
</pre></div>
<p>It is not necessary to have a second copy of the documentation for the attribute in the class docstring, only a reference to the method (typically <tt class="docutils literal">__init__</tt> which does document the attribute's meaning).
Of course, if there is any interesting additional behavior about the attribute that does not apply to the <tt class="docutils literal">__init__</tt> argument, that behavior should be documented in the class docstring.</p>
<p>Docstrings are <em>never</em> to be used to provide semantic information about an object; this rule may be violated if the code in question is to be used in a system where this is a requirement (such as Zope).</p>
<p>Docstrings should be indented to the level of the code they are documenting.</p>
<p>Docstrings must be triple-quoted, with opening and the closing of the docstrings being on a line by themselves.
For example:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Ninja</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A L{Ninja} is a warrior specializing in various unorthodox arts of war.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">attack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">someone</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Attack C{someone} with this L{Ninja}'s shuriken.</span>
<span class="sd">        """</span>
</pre></div>
<p>Docstrings are written in epytext format; more documentation is available in the <a class="reference external" href="http://epydoc.sourceforge.net/manual-epytext.html">Epytext Markup Language documentation</a>.</p>
<p>When you are referring to a type, you should use <cite>L{}</cite>, whether it's in the stdlib , in Twisted or somewhere else.</p>
<p><cite>NoneType</cite> is an exception and we are referring it just as <cite>L{None}</cite>.</p>
<p>Pydoctor, the software we use to generate the documentation, links to the Python standard library if you use <tt class="docutils literal">L{}</tt> with standard Python types (e.g. <tt class="docutils literal">L{str}</tt>).</p>
<p>For the API doc <cite>C{something}</cite> means "I made up a new word, and I want it to be monospaced, like it's an identifier in code and not an English noun"</p>
<p><cite>L{something}</cite> means "I am referring to the previously-defined concept/package/module/class/function/method/attribute identified as <cite>something</cite>"</p>
<p>Additionally, to accommodate emacs users, single quotes of the type of the docstring's triple-quote should be escaped.
This will prevent font-lock from accidentally fontifying large portions of the file as a string.</p>
<p>For example,</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo2bar</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Convert L{foo}s to L{bar}s.</span>

<span class="sd">    A function that should be used when you have a C{foo} but you want a</span>
<span class="sd">    C{bar}; note that this is a non-destructive operation.  If this method</span>
<span class="sd">    can't convert the C{foo} to a C{bar} it will raise a L{FooException}.</span>

<span class="sd">    @param f: C{foo}</span>
<span class="sd">    @type f: L{str}</span>

<span class="sd">    For example::</span>

<span class="sd">        import wombat</span>
<span class="sd">        def sample(something):</span>
<span class="sd">            f = something.getFoo()</span>
<span class="sd">            f.doFooThing()</span>
<span class="sd">            b = wombat.foo2bar(f)</span>
<span class="sd">            b.doBarThing()</span>
<span class="sd">            return b</span>

<span class="sd">    """</span>
    <span class="c1"># Optionally, actual code can go here.</span>
</pre></div>
</div>
<div class="section" id="comments">
<h2><a class="toc-backref" href="#id13">Comments</a></h2>
<p>Start by reading the <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/#comments">PEP8 Comments section</a>.
Ignore <cite>Documentation Strings</cite> section from PEP8 as Twisted uses a different docstring standard.</p>
<p><cite>FIXME/TODO</cite> comments must have an associated ticket and contain a reference to it in the form of a full URL to the ticket.
A brief amount of text should provide info about why the FIXME was added.
It does not have to be the full ticket description, just enough to help readers decide if their next step should be reading the ticket or continue reading the code.</p>
<div class="highlight"><pre><span></span><span class="c1"># FIXME: https://twistedmatrix.com/trac/ticket/1235</span>
<span class="c1"># Threads that have died before calling stop() are not joined.</span>
<span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="versioning">
<h2><a class="toc-backref" href="#id14">Versioning</a></h2>
<p>The API documentation should be marked up with version information.
When a new API is added the class should be marked with the epytext <a class="reference external" href="http://epydoc.sourceforge.net/manual-fields.html#status">@since: field</a> to include the version number when the change was introduced.
The placeholder string <tt class="docutils literal">Twisted NEXT</tt> will be <a class="reference external" href="https://github.com/twisted/incremental#updating">replaced at release time</a> with the appropriate version number.
For example:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bar2baz</span><span class="p">():</span>
    <span class="sd">"""</span>
<span class="sd">    Bazify a bar.</span>

<span class="sd">    @since: Twisted NEXT</span>
<span class="sd">    """</span>
</pre></div>
<p>The <tt class="docutils literal">@since</tt> tag cannot be applied to arguments.
When adding a new argument, indicate the version of introduction on a separate line.
For example, if the <tt class="docutils literal">swizzle</tt> keyword argument is added after the release of the above function in Twisted 18.5.0:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bar2baz</span><span class="p">(</span><span class="n">swizzle</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Bazify a bar, with optional swizzling.</span>

<span class="sd">    @param swizzle: Activate swizzling.</span>

<span class="sd">        Present Since Twisted NEXT</span>

<span class="sd">    @type swizzle: L{bool}</span>

<span class="sd">    @since: Twisted 18.5.0</span>
<span class="sd">    """</span>
</pre></div>
</div>
<div class="section" id="scripts">
<h2><a class="toc-backref" href="#id15">Scripts</a></h2>
<p>For each "script" , that is, a program you expect a Twisted user to run from the command-line, the following things must be done:</p>
<ol class="arabic">
<li><p class="first">Write a module in <cite>twisted.scripts</cite> which contains a callable global named <tt class="docutils literal">run</tt>.
This will be called by the command line part with no arguments (it will usually read <tt class="docutils literal">sys.argv</tt> ).
Feel free to write more functions or classes in this module, if you feel they are useful to others.</p>
</li>
<li><p class="first">Create a file which contains a shebang line for Python.
This file should be placed in the <tt class="docutils literal">bin/</tt> directory; for example, <tt class="docutils literal">bin/twistd</tt>.</p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
</pre></div>
</li>
</ol>
<p>To make sure that the script is portable across different UNIX like operating systems we use the <tt class="docutils literal">/usr/bin/env</tt> command.
The env command allows you to run a program in a modified environment.
That way you don't have to search for a program via the <tt class="docutils literal">PATH</tt> environment variable.
This makes the script more portable but note that it is not a foolproof method.
Always make sure that <tt class="docutils literal">/usr/bin/env</tt> exists or use a softlink/symbolic link to point it to the correct path.
Python's distutils will rewrite the shebang line upon installation so this policy only covers the source files in version control.</p>
<ol class="arabic">
<li><p class="first">For core scripts, add an entry point to <tt class="docutils literal">"console_scripts"</tt> in <tt class="docutils literal">setup.cfg</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">[options.entry_points]</span>
<span class="na">console_scripts</span> <span class="o">=</span>
    <span class="na">...</span>
    <span class="na">twistd</span> <span class="o">=</span> <span class="s">twisted.scripts.twistd:run</span>
    <span class="na">yourmodule</span> <span class="o">=</span> <span class="s">twisted.scripts.yourmodule:run</span>
</pre></div>
</li>
<li><p class="first">And end with:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.scripts.yourmodule</span> <span class="kn">import</span> <span class="n">run</span>
<span class="n">run</span><span class="p">()</span>
</pre></div>
</li>
<li><p class="first">Write a manpage and add it to the <tt class="docutils literal">man</tt> folder of a subproject's <tt class="docutils literal">doc</tt> folder.
On Debian systems you can find a skeleton example of a manpage in <tt class="docutils literal"><span class="pre">/usr/share/doc/man-db/examples/manpage.example</span></tt>.</p>
</li>
</ol>
<p>This will ensure that your program will have a proper <tt class="docutils literal">console_scripts</tt> entry point, which
<tt class="docutils literal">setup.py</tt> will use to generate a console script which will work correctly for users of
Git, Windows releases and Debian packages.</p>
</div>
<div class="section" id="examples">
<h2><a class="toc-backref" href="#id16">Examples</a></h2>
<p>For example scripts you expect a Twisted user to run from the command-line, add this Python shebang line at the top of the file:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
</pre></div>
</div>
<div class="section" id="standard-library-extension-modules">
<h2><a class="toc-backref" href="#id17">Standard Library Extension Modules</a></h2>
<p>When using the extension version of a module for which there is also a Python version, place the import statement inside a try/except block, and import the Python version if the import fails.
This allows code to work on platforms where the extension version is not available.
For example:</p>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pickle</span>
</pre></div>
<p>Use the "as" syntax of the import statement as well, to set the name of the extension module to the name of the Python module.</p>
<p>Some modules don't exist across all supported Python versions.
For example, Python 2.3's <tt class="docutils literal">sets</tt> module was deprecated in Python 2.6 in favor of the <tt class="docutils literal">set</tt> and <tt class="docutils literal">frozenset</tt> builtins.
<cite>twisted.python.compat</cite> would be the place to add <tt class="docutils literal">set</tt> and <tt class="docutils literal">frozenset</tt> implementations that work across Python versions.</p>
</div>
<div class="section" id="classes">
<h2><a class="toc-backref" href="#id18">Classes</a></h2>
<p>Classes are to be named in mixed case, with the first letter capitalized; each word separated by having its first letter capitalized.
Acronyms should be capitalized in their entirety.
Class names should not be prefixed with the name of the module they are in.
Examples of classes meeting this criteria:</p>
<ul class="simple">
<li><tt class="docutils literal">twisted.spread.pb.ViewPoint</tt></li>
<li><tt class="docutils literal">twisted.parser.patterns.Pattern</tt></li>
</ul>
<p>Examples of classes <strong>not</strong> meeting this criteria:</p>
<ul class="simple">
<li><tt class="docutils literal">event.EventHandler</tt></li>
<li><tt class="docutils literal">main.MainGadget</tt></li>
</ul>
<p>An effort should be made to prevent class names from clashing with each other between modules, to reduce the need for qualification when importing.
For example, a Service subclass for Forums might be named <tt class="docutils literal">twisted.forum.service.ForumService</tt>, and a Service subclass for Words might be <tt class="docutils literal">twisted.words.service.WordsService</tt>.
Since neither of these modules are volatile <em>(see above)</em> the classes may be imported directly into the user's namespace and not cause confusion.</p>
<div class="section" id="new-style-classes">
<h3><a class="toc-backref" href="#id19">New-style Classes</a></h3>
<p>Classes and instances in Python come in two flavors: old-style or classic, and new-style.
Up to Python 2.1, old-style classes were the only flavour available to the user, new-style classes were introduced in Python 2.2 to unify classes and types.
All classes added to Twisted must be written as new-style classes.
If <tt class="docutils literal">x</tt> is an instance of a new-style class, then <tt class="docutils literal">type(x)</tt> is the same as <tt class="docutils literal">x.__class__</tt>.</p>
</div>
</div>
<div class="section" id="methods">
<h2><a class="toc-backref" href="#id20">Methods</a></h2>
<p>Methods should be in mixed case, with the first letter lower case, each word separated by having its first letter capitalized.
For example, <tt class="docutils literal">someMethodName</tt>, <tt class="docutils literal">method</tt>.</p>
<p>Sometimes, a class will dispatch to a specialized sort of method using its name; for example, <tt class="docutils literal">twisted.reflect.Accessor</tt>.
In those cases, the type of method should be a prefix in all lower-case with a trailing underscore, so method names will have an underscore in them.
For example, <tt class="docutils literal">get_someAttribute</tt>.
Underscores in method names in twisted code are therefore expected to have some semantic associated with them.</p>
<p>Some methods, in particular <tt class="docutils literal">addCallback</tt> and its cousins return self to allow for chaining calls.
In this case, wrap the chain in parenthesis, and start each chained call on a separate line, for example:</p>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="p">(</span><span class="n">foo</span><span class="p">()</span>
        <span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>
        <span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">thud</span><span class="p">)</span>
        <span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">wozers</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="using-the-global-reactor">
<h2><a class="toc-backref" href="#id21">Using the Global Reactor</a></h2>
<p>Even though it may be convenient, module-level imports of the global Twisted reactor (<tt class="docutils literal">from twisted.internet import reactor</tt>) should be avoided.
Importing the reactor at the module level means that reactor selection occurs on initial import, and not at the request of the code that originally imported the module.
Applications may wish to import their own reactor, or otherwise use a reactor different than Twisted's default (for example, using the experimental cfreactor on macOS); importing at the module level means they would have to monkeypatch in the different reactor, or use similar hacks.
This is especially apparent in Twisted's own test suite; many tests wish to provide their own reactor which controls the passage of time and simulates timeouts.</p>
<p>Below is an example of the pattern for accepting the user's choice of reactor -- importing the global one if none is specified -- taken (and trimmed for brevity) from existing Twisted source code.</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A user's session with a system.</span>

<span class="sd">    @ivar _reactor: An object providing L{IReactorTime} to use for scheduling</span>
<span class="sd">        expiration.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">reactor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Initialize a session with a unique ID for that session.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">reactor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reactor</span> <span class="o">=</span> <span class="n">reactor</span>

        <span class="c1"># ... other code ...</span>
</pre></div>
<p>The reactor attribute should be private by default, but if it is useful to the users of the code, there is no reason why it can not be public.</p>
</div>
<div class="section" id="callback-arguments">
<h2><a class="toc-backref" href="#id22">Callback Arguments</a></h2>
<p>There are several methods whose purpose is to help the user set up callback functions, for example <cite>Deferred.addCallback &lt;twisted.internet.defer.Deferred.addCallback&gt;</cite> or the reactor's <cite>callLater &lt;twisted.internet.base.ReactorBase.callLater&gt;</cite> method.
To make access to the callback as transparent as possible, most of these methods use <tt class="docutils literal">**kwargs</tt> to capture arbitrary arguments that are destined for the user's callback.
This allows the call to the setup function to look very much like the eventual call to the target callback function.</p>
<p>In these methods, take care to not have other argument names that will "steal" the user's callback's arguments.
When sensible, prefix these "internal" argument names with an underscore.
For example, <cite>RemoteReference.callRemote &lt;twisted.spread.pb.RemoteReference.callRemote&gt;</cite> is meant to be called like this:</p>
<div class="highlight"><pre><span></span><span class="n">myref</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s2">"addUser"</span><span class="p">,</span> <span class="s2">"bob"</span><span class="p">,</span> <span class="s2">"555-1212"</span><span class="p">)</span>

<span class="c1"># on the remote end, the following method is invoked:</span>
<span class="k">def</span> <span class="nf">addUser</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">phone</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
<p>where "addUser" is the remote method name.
The user might also choose to call it with named parameters like this:</p>
<div class="highlight"><pre><span></span><span class="n">myref</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s2">"addUser"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bob"</span><span class="p">,</span> <span class="n">phone</span><span class="o">=</span><span class="s2">"555-1212"</span><span class="p">)</span>
</pre></div>
<p>In this case, <tt class="docutils literal">callRemote</tt> (and any code that uses the <tt class="docutils literal">**kwargs</tt> syntax) must be careful to not use "name", "phone", or any other name that might overlap with a user-provided named parameter.
Therefore, <tt class="docutils literal">callRemote</tt> is implemented with the following signature:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">callRemote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
<p>Do whatever you can to reduce user confusion.
It may also be appropriate to <tt class="docutils literal">assert</tt> that the kwargs dictionary does not contain parameters with names that will eventually cause problems.</p>
</div>
<div class="section" id="special-methods">
<h2><a class="toc-backref" href="#id23">Special Methods</a></h2>
<p>The augmented assignment protocol, defined by <tt class="docutils literal">__iadd__</tt> and other similarly named methods, can be used to allow objects to be modified in place or to rebind names if an object is immutable -- both through use of the same operator.
This can lead to confusing code, which in turn leads to buggy code.
For this reason, methods of the augmented assignment protocol should not be used in Twisted.</p>
</div>
<div class="section" id="functions">
<h2><a class="toc-backref" href="#id24">Functions</a></h2>
<p>Functions should be named similarly to methods.</p>
<p>Functions or methods which are responding to events to complete a callback or errback should be named <tt class="docutils literal">_cbMethodName</tt> or <tt class="docutils literal">_ebMethodName</tt>, in order to distinguish them from normal methods.</p>
</div>
<div class="section" id="attributes">
<h2><a class="toc-backref" href="#id25">Attributes</a></h2>
<p>Attributes should be named similarly to functions and methods.
Attributes should be named descriptively; attribute names like <tt class="docutils literal">mode</tt>, <tt class="docutils literal">type</tt>, and <tt class="docutils literal">buf</tt> are generally discouraged.
Instead, use <tt class="docutils literal">displayMode</tt>, <tt class="docutils literal">playerType</tt>, or <tt class="docutils literal">inputBuffer</tt>.</p>
<p>Do not use Python's "private" attribute syntax; prefix non-public attributes with a single leading underscore.
Since several classes have the same name in Twisted, and they are distinguished by which package they come from, Python's double-underscore name mangling will not work reliably in some cases.
Also, name-mangled private variables are more difficult to address when unit testing or persisting a class.</p>
<p>An attribute (or function, method or class) should be considered private when one or more of the following conditions are true:</p>
<ul class="simple">
<li>The attribute represents intermediate state which is not always kept up-to-date.</li>
<li>Referring to the contents of the attribute or otherwise maintaining a reference to it may cause resources to leak.</li>
<li>Assigning to the attribute will break internal assumptions.</li>
<li>The attribute is part of a known-to-be-sub-optimal interface and will certainly be removed in a future release.</li>
</ul>
</div>
<div class="section" id="python-3">
<h2><a class="toc-backref" href="#id26">Python 3</a></h2>
<p>Twisted is being ported to Python 3, targeting Python 3.5+.
Please see <a class="reference external" href="{filename}/core/howto/python3.rst">Porting to Python 3</a> for details.</p>
<p>All new modules must be Python 2.7 &amp; 3.5+ compatible, and all new code to ported modules must be Python 2.7 &amp; 3.5+ compatible.
New code in non-ported modules must be written in a 2.7 &amp; 3.5+ compatible way (explicit bytes/unicode strings, new exception raising format, etc) as to prevent extra work when that module is eventually ported.
Code targeting Python 3 specific features must gracefully fall-back on Python 2 as much as is reasonably possible (for example, Python 2 support for 'async/await' is not reasonably possible and would not be required, but code that uses a Python 3-specific module such as ipaddress should be able to use a backport to 2.7 if available).</p>
</div>
<div class="section" id="database">
<h2><a class="toc-backref" href="#id27">Database</a></h2>
<p>Database tables will be named with plural nouns.</p>
<p>Database columns will be named with underscores between words, all lower case, since most databases do not distinguish between case.</p>
<p>Any attribute, method argument, or method name that corresponds <em>directly</em> to a column in the database will be named exactly the same as that column, regardless of other coding conventions surrounding that circumstance.</p>
<p>All SQL keywords should be in upper case.</p>
</div>
<div class="section" id="c-code">
<h2><a class="toc-backref" href="#id28">C Code</a></h2>
<p>C code must be optional, and work across multiple platforms (MSVC++9/10/14 for Pythons 2.7 and 3.5+ on Windows, as well as recent GCCs and Clangs for Linux, macOS, and FreeBSD).</p>
<p>C code should be kept in external bindings packages which Twisted depends on.
If creating new C extension modules, using <a class="reference external" href="https://cffi.readthedocs.io/en/latest/">cffi</a> is highly encouraged, as it will perform well on PyPy and CPython, and be easier to use on Python 2 and 3.
Consider optimizing for <a class="reference external" href="https://pypy.org/performance.html">PyPy</a> instead of creating bespoke C code.</p>
</div>
<div class="section" id="commit-messages">
<h2><a class="toc-backref" href="#id29">Commit Messages</a></h2>
<p>The commit messages are being distributed in a myriad of ways.
Because of that, you need to observe a few simple rules when writing a commit message.</p>
<p>The first line of the message is being used as both the subject of the commit email and the announcement on #twisted.
Therefore, it should be short (aim for &lt; 80 characters) and descriptive -- and must be able to stand alone (it is best if it is a complete sentence).
The rest of the e-mail should be separated with <em>hard line breaks</em> into short lines (&lt; 70 characters).
This is free-format, so you can do whatever you like here.</p>
<p>Commit messages should be about <em>what</em>, not <em>how</em>: we can get how from Git diff.
Explain reasons for commits, and what they affect.</p>
<p>Each commit should be a single logical change, which is internally consistent.
If you can't summarize your changes in one short line, this is probably a sign that they should be broken into multiple checkins.</p>
</div>
<div class="section" id="source-control">
<h2><a class="toc-backref" href="#id30">Source Control</a></h2>
<p>Twisted currently uses Git for source control.
All development must occur using branches; when a task is considered complete another Twisted developer may review it and if no problems are found, it may be merged into trunk.
The Twisted wiki has <a class="reference external" href="https://twistedmatrix.com/trac/wiki/TwistedDevelopment">a start</a>.</p>
<p>If you wish to ignore certain files, create a <tt class="docutils literal">.gitignore</tt> file, or edit it if it exists.
For example:</p>
<blockquote>
<div class="highlight"><pre><span></span><span class="go">dropin.cache</span>
<span class="go">*.pyc</span>
<span class="go">*.pyo</span>
<span class="go">*.o</span>
<span class="go">*.lo</span>
<span class="go">*.la #*#</span>
<span class="go">.*.rej</span>
<span class="go">*.rej</span>
<span class="go">.*~</span>
</pre></div>
</blockquote>
</div>
<div class="section" id="fallback">
<h2><a class="toc-backref" href="#id31">Fallback</a></h2>
<p>In case of conventions not enforced in this document, the reference documents to use in fallback are:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/psf/black/blob/master/docs/the_black_code_style.md">The Black code style</a></li>
<li><a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a> for Python code</li>
<li><a class="reference external" href="https://www.python.org/dev/peps/pep-0007/">PEP 7</a> for C code</li>
</ul>
</div>
<div class="section" id="recommendations">
<h2><a class="toc-backref" href="#id32">Recommendations</a></h2>
<p>These things aren't necessarily standardizeable (in that code can't be easily checked for compliance) but are a good idea to keep in mind while working on Twisted.</p>
<p>If you're going to work on a fragment of the Twisted codebase, please consider finding a way that you would <em>use</em> such a fragment in daily life.
Using a Twisted Web server on your website encourages you to actively maintain and improve your code, as the little everyday issues with using it become apparent.
Twisted is a <strong>big</strong> codebase!
If you're refactoring something, please make sure to recursively grep for the names of functions you're changing.
You may be surprised to learn where something is called.
Especially if you are moving or renaming a function, class, method, or module, make sure that it won't instantly break other code.</p>

</div>

        </div>
        </div>
        </div>
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<div class="toc" id="">
<p class="topic-title">Table Of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#naming" id="id2">Naming</a></li>
<li><a class="reference internal" href="#testing" id="id3">Testing</a><ul>
<li><a class="reference internal" href="#overview" id="id4">Overview</a></li>
<li><a class="reference internal" href="#test-suite" id="id5">Test Suite</a></li>
</ul>
</li>
<li><a class="reference internal" href="#copyright-header" id="id6">Copyright Header</a></li>
<li><a class="reference internal" href="#whitespace" id="id7">Whitespace</a></li>
<li><a class="reference internal" href="#modules" id="id8">Modules</a></li>
<li><a class="reference internal" href="#packages" id="id9">Packages</a></li>
<li><a class="reference internal" href="#strings" id="id10">Strings</a><ul>
<li><a class="reference internal" href="#string-formatting-operations" id="id11">String Formatting Operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#docstrings" id="id12">Docstrings</a></li>
<li><a class="reference internal" href="#comments" id="id13">Comments</a></li>
<li><a class="reference internal" href="#versioning" id="id14">Versioning</a></li>
<li><a class="reference internal" href="#scripts" id="id15">Scripts</a></li>
<li><a class="reference internal" href="#examples" id="id16">Examples</a></li>
<li><a class="reference internal" href="#standard-library-extension-modules" id="id17">Standard Library Extension Modules</a></li>
<li><a class="reference internal" href="#classes" id="id18">Classes</a><ul>
<li><a class="reference internal" href="#new-style-classes" id="id19">New-style Classes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#methods" id="id20">Methods</a></li>
<li><a class="reference internal" href="#using-the-global-reactor" id="id21">Using the Global Reactor</a></li>
<li><a class="reference internal" href="#callback-arguments" id="id22">Callback Arguments</a></li>
<li><a class="reference internal" href="#special-methods" id="id23">Special Methods</a></li>
<li><a class="reference internal" href="#functions" id="id24">Functions</a></li>
<li><a class="reference internal" href="#attributes" id="id25">Attributes</a></li>
<li><a class="reference internal" href="#python-3" id="id26">Python 3</a></li>
<li><a class="reference internal" href="#database" id="id27">Database</a></li>
<li><a class="reference internal" href="#c-code" id="id28">C Code</a></li>
<li><a class="reference internal" href="#commit-messages" id="id29">Commit Messages</a></li>
<li><a class="reference internal" href="#source-control" id="id30">Source Control</a></li>
<li><a class="reference internal" href="#fallback" id="id31">Fallback</a></li>
<li><a class="reference internal" href="#recommendations" id="id32">Recommendations</a></li>
</ul>
</div>
</div>
</div>    </div>

    </section>

        <div id="footer"><hr>
                <div> </div>
                <p class="left2">
        Copyright 2021, Twisted Matrix Labs. Ver 21.2.0. Built on 2021-02-28.<br />
        Site design<br />
        By <a href="http://huw.ugbox.net/">huw.wilkins.</a>

                </p>
                <p class="right"></p>
        </div>


</body>
</html>