<!DOCTYPE html>
<html lang="en">
<head>
          <title>Test Pelican - WSGI</title>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />

        <meta name="Description" content="An event-driven networking engine written in Python and MIT licensed." />

        <link rel="stylesheet" type="text/css" href="https://judgegregg.github.io/pelitwi/theme/css/twistedtrac.css" />


</head>

<body>
        <div id="banner">
                <div id="top_grad"></div>
                <div id="tab">
                        <a href="https://twistedmatrix.com/trac/wiki">HOME</a>
                        <a href="https://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions">FAQ</a>
                        <a href="/">DOCS</a>
                        <a href="https://twistedmatrix.com/trac/wiki/Downloads">DOWNLOAD</a>
                </div>

                <div id="header">
                        <a id="logo" href="https://judgegregg.github.io/pelitwi/"><img src="https://judgegregg.github.io/pelitwi/theme/images/trac_banner.png" alt="Twisted" /></a>
                </div>
        </div>

<div id="mainnav" class="related">
	<ul>
		<li><a href="https://judgegregg.github.io/pelitwi">Twisted 21.2.0 documentation</a> Â»</li>
	</ul>
</div>
        <div id="ctxtnav" class="nav">
        </div>

    <section>

    <div class="document">
        <div class="documentwrapper">
        <div class="bodywrapper">
        <h1>WSGI</h1>
        
        <div class="entry-content">
        <p>The goal of this example is to show you how to
use <cite>WSGIResource &lt;twisted.web.wsgi.WSGIResource&gt;</cite> ,
another existing <cite>Resource &lt;twisted.web.resource.Resource&gt;</cite> subclass, to
serve <a class="reference external" href="http://www.python.org/dev/peps/pep-0333/">WSGI applications</a>
in a Twisted Web server.</p>
<p>Note that <tt class="docutils literal">WSGIResource</tt> is a multithreaded WSGI container. Like
any other WSGI container, you can't do anything asynchronous in your WSGI
applications, even though this is a Twisted WSGI container.</p>
<p>The first new thing in this example is the import
of <tt class="docutils literal">WSGIResource</tt> :</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.web.wsgi</span> <span class="kn">import</span> <span class="n">WSGIResource</span>
</pre></div>
<p>Nothing too surprising there. We still need one of the other usual suspects,
too:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>
</pre></div>
<p>You'll see why in a minute. Next, we need a WSGI application. Here's a really
simple one just to get things going:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
    <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;Hello, world!&#39;</span><span class="p">]</span>
</pre></div>
<p>If this doesn't make sense to you, take a look at one of
these <a class="reference external" href="https://wsgi.readthedocs.io/en/latest/learn.html">fine tutorials</a> . Otherwise,
or once you're done with that, the next step is to create
a <tt class="docutils literal">WSGIResource</tt> instance, as this is going to be
another <a class="reference external" href="https://judgegregg.github.io/pelitwi/pages/rpy-scripts-or-how-to-save-yourself-some-typing.html">rpy script</a> example:</p>
<div class="highlight"><pre><span></span><span class="n">resource</span> <span class="o">=</span> <span class="n">WSGIResource</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="n">reactor</span><span class="o">.</span><span class="n">getThreadPool</span><span class="p">(),</span> <span class="n">application</span><span class="p">)</span>
</pre></div>
<p>Let's dwell on this line for a minute. The first parameter passed
to <tt class="docutils literal">WSGIResource</tt> is the reactor. Despite the fact that the
reactor is global and any code that wants it can always just import it
(as, in fact, this rpy script simply does itself), passing it around
as a parameter leaves the door open for certain future possibilities -
for example, having more than one reactor. There are also testing
implications. Consider how much easier it is to unit test a function
that accepts a reactor - perhaps a mock reactor specially constructed
to make your tests easy to write - rather than importing the real
global reactor. That's why <tt class="docutils literal">WSGIResource</tt> requires you to
pass the reactor to it.</p>
<p>The second parameter passed to <tt class="docutils literal">WSGIResource</tt> is
a <cite>ThreadPool &lt;twisted.python.threadpool.ThreadPool&gt;</cite> . <tt class="docutils literal">WSGIResource</tt>
uses this to actually call the application object passed in to it. To keep this
example short, we're passing in the reactor's internal threadpool here, letting
us skip its creation and shutdown-time destruction. For finer control over how
many WSGI requests are served in parallel, you may want to create your own
thread pool to use with your <tt class="docutils literal">WSGIResource</tt> , but for simple testing,
using the reactor's is fine.</p>
<p>The final argument is the application object. This is pretty typical of how
WSGI containers work.</p>
<p>The example, sans interruption:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.web.wsgi</span> <span class="kn">import</span> <span class="n">WSGIResource</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>

<span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
    <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;Hello, world!&#39;</span><span class="p">]</span>

<span class="n">resource</span> <span class="o">=</span> <span class="n">WSGIResource</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="n">reactor</span><span class="o">.</span><span class="n">getThreadPool</span><span class="p">(),</span> <span class="n">application</span><span class="p">)</span>
</pre></div>
<p>Up to the point where the <tt class="docutils literal">WSGIResource</tt> instance defined here
exists in the resource hierarchy, the normal resource traversal rules
apply: <cite>getChild &lt;twisted.web.resource.Resource.getChild&gt;</cite>
will be called to handle each segment. Once the <tt class="docutils literal">WSGIResource</tt> is
encountered, though, that process stops and all further URL handling is the
responsibility of the WSGI application. This application does nothing with the
URL, though, so you won't be able to tell that.</p>
<p>Oh, and as was the case with the first static file example, there's also a
command line option you can use to avoid a lot of this. If you just put the
above application function, without all of the <tt class="docutils literal">WSGIResource</tt> stuff,
into a file, say, <tt class="docutils literal">foo.py</tt> , then you can launch a roughly equivalent
server like this:</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span>twistd -n web --wsgi foo.application
</pre></div>

        </div>
        </div>
        </div>
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
</div>
</div>    </div>

    </section>

        <div id="footer"><hr>
                <div> </div>
                <p class="left2">
        Copyright 2021, Twisted Matrix Labs. Ver 21.2.0. Built on 2021-02-28.<br />
        Site design<br />
        By <a href="http://huw.ugbox.net/">huw.wilkins.</a>

                </p>
                <p class="right"></p>
        </div>


</body>
</html>