<!DOCTYPE html>
<html lang="en">
<head>
          <title>Test Pelican - Session Basics</title>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />

        <meta name="Description" content="An event-driven networking engine written in Python and MIT licensed." />

        <link rel="stylesheet" type="text/css" href="https://judgegregg.github.io/pelitwi/theme/css/twistedtrac.css" />


</head>

<body>
        <div id="banner">
                <div id="top_grad"></div>
                <div id="tab">
                        <a href="https://twistedmatrix.com/trac/wiki">HOME</a>
                        <a href="https://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions">FAQ</a>
                        <a href="/">DOCS</a>
                        <a href="https://twistedmatrix.com/trac/wiki/Downloads">DOWNLOAD</a>
                </div>

                <div id="header">
                        <a id="logo" href="https://judgegregg.github.io/pelitwi/"><img src="https://judgegregg.github.io/pelitwi/theme/images/trac_banner.png" alt="Twisted" /></a>
                </div>
        </div>

<div id="mainnav" class="related">
	<ul>
		<li><a href="https://judgegregg.github.io/pelitwi">Twisted 21.2.0 documentation</a> Â»</li>
	</ul>
</div>
        <div id="ctxtnav" class="nav">
        </div>

    <section>

    <div class="document">
        <div class="documentwrapper">
        <div class="bodywrapper">
        <h1>Session Basics</h1>
        
        <div class="entry-content">
        <p>Sessions are the most complicated topic covered in this series of examples,
and because of that it is going to take a few examples to cover all of the
different aspects. This first example demonstrates the very basics of the
Twisted Web session API: how to get the session object for the current request
and how to prematurely expire a session.</p>
<p>Before diving into the APIs, let's look at the big picture of
sessions in Twisted Web. Sessions are represented by instances
of <cite>Session &lt;twisted.web.server.Session&gt;</cite> . The <cite>Site &lt;twisted.web.server.Site&gt;</cite> creates a new instance
of <tt class="docutils literal">Session</tt> the first time an application asks for it for
a particular session. <tt class="docutils literal">Session</tt> instances are kept on
the <tt class="docutils literal">Site</tt> instance until they expire (due to inactivity or
because they are explicitly expired). Each time after the first that a
particular session's <tt class="docutils literal">Session</tt> object is requested, it is
retrieved from the <tt class="docutils literal">Site</tt> .</p>
<p>With the conceptual underpinnings of the upcoming API in place, here comes
the example. This will be a very simple <a class="reference external" href="https://judgegregg.github.io/pelitwi/pages/rpy-scripts-or-how-to-save-yourself-some-typing.html">rpy script</a> which tells a user what its unique session identifier is and lets it
prematurely expire the session.</p>
<p>First, we'll import <cite>Resource &lt;twisted.web.resource.Resource&gt;</cite> so we can define a couple of
subclasses of it:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.web.resource</span> <span class="kn">import</span> <span class="n">Resource</span>
</pre></div>
<p>Next we'll define the resource which tells the client what its session
identifier is. This is done easily by first getting the session object
using <cite>Request.getSession &lt;twisted.web.server.Request.getSession&gt;</cite> and
then getting the session object's uid attribute:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ShowSession</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;Your session id is: &#39;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">getSession</span><span class="p">()</span><span class="o">.</span><span class="n">uid</span>
</pre></div>
<p>To let the client expire its own session before it times out, we'll define
another resource which expires whatever session it is requested with. This is
done using the <cite>Session.expire &lt;twisted.web.server.Session.expire&gt;</cite>
method:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExpireSession</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">request</span><span class="o">.</span><span class="n">getSession</span><span class="p">()</span><span class="o">.</span><span class="n">expire</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;Your session has been expired.&#39;</span>
</pre></div>
<p>Finally, to make the example an rpy script, we'll make an instance
of <tt class="docutils literal">ShowSession</tt> and give it an instance
of <tt class="docutils literal">ExpireSession</tt> as a child using <cite>Resource.putChild &lt;twisted.web.resource.Resource.putChild&gt;</cite> :</p>
<div class="highlight"><pre><span></span><span class="n">resource</span> <span class="o">=</span> <span class="n">ShowSession</span><span class="p">()</span>
<span class="n">resource</span><span class="o">.</span><span class="n">putChild</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;expire&quot;</span><span class="p">,</span> <span class="n">ExpireSession</span><span class="p">())</span>
</pre></div>
<p>And that is the complete example. You can fire this up and load the top
page. You'll see a (rather opaque) session identifier that remains the same
across reloads (at least until you flush the <tt class="docutils literal">TWISTED_SESSION</tt> cookie
from your browser or enough time passes). You can then visit
the <tt class="docutils literal">expire</tt> child and go back to the top page and see that you have
a new session.</p>
<p>Here's the complete source for the example:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.web.resource</span> <span class="kn">import</span> <span class="n">Resource</span>

<span class="k">class</span> <span class="nc">ShowSession</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;Your session id is: &#39;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">getSession</span><span class="p">()</span><span class="o">.</span><span class="n">uid</span>

<span class="k">class</span> <span class="nc">ExpireSession</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">request</span><span class="o">.</span><span class="n">getSession</span><span class="p">()</span><span class="o">.</span><span class="n">expire</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;Your session has been expired.&#39;</span>

<span class="n">resource</span> <span class="o">=</span> <span class="n">ShowSession</span><span class="p">()</span>
<span class="n">resource</span><span class="o">.</span><span class="n">putChild</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;expire&quot;</span><span class="p">,</span> <span class="n">ExpireSession</span><span class="p">())</span>
</pre></div>

        </div>
        </div>
        </div>
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
</div>
</div>    </div>

    </section>

        <div id="footer"><hr>
                <div> </div>
                <p class="left2">
        Copyright 2021, Twisted Matrix Labs. Ver 21.2.0. Built on 2021-02-28.<br />
        Site design<br />
        By <a href="http://huw.ugbox.net/">huw.wilkins.</a>

                </p>
                <p class="right"></p>
        </div>


</body>
</html>