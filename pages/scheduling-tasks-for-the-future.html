<!DOCTYPE html>
<html lang="en">
<head>
          <title>Test Pelican - Scheduling tasks for the future</title>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />

        <meta name="Description" content="An event-driven networking engine written in Python and MIT licensed." />

        <link rel="stylesheet" type="text/css" href="https://judgegregg.github.io/pelitwi/theme/css/twistedtrac.css" />


</head>

<body>
        <div id="banner">
                <div id="top_grad"></div>
                <div id="tab">
                        <a href="https://twistedmatrix.com/trac/wiki">HOME</a>
                        <a href="https://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions">FAQ</a>
                        <a href="/">DOCS</a>
                        <a href="https://twistedmatrix.com/trac/wiki/Downloads">DOWNLOAD</a>
                </div>

                <div id="header">
                        <a id="logo" href="https://judgegregg.github.io/pelitwi/"><img src="https://judgegregg.github.io/pelitwi/theme/images/trac_banner.png" alt="Twisted" /></a>
                </div>
        </div>

<div id="mainnav" class="related">
	<ul>
		<li><a href="https://judgegregg.github.io/pelitwi">Twisted 21.2.0 documentation</a> Â»</li>
	</ul>
</div>
        <div id="ctxtnav" class="nav">
        </div>

    <section>

    <div class="document">
        <div class="documentwrapper">
        <div class="bodywrapper">
        <h1>Scheduling tasks for the future</h1>
        
        <div class="entry-content">
        <p>Let's say we want to run a task X seconds in the future.
The way to do that is defined in the reactor interface <cite>twisted.internet.interfaces.IReactorTime</cite> :</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"this will run 3.5 seconds after it was scheduled: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>

<span class="n">reactor</span><span class="o">.</span><span class="n">callLater</span><span class="p">(</span><span class="mf">3.5</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s2">"hello, world"</span><span class="p">)</span>

<span class="c1"># f() will only be called if the event loop is started.</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
<p>If the result of the function is important or if it may be necessary
to handle exceptions it raises, then the <cite>twisted.internet.task.deferLater</cite> utility conveniently
takes care of creating a <cite>Deferred &lt;twisted.internet.defer.Deferred&gt;</cite> and setting up a delayed
call:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">"This will run 3.5 seconds after it was scheduled: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">s</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">deferLater</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s2">"hello, world"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">called</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">called</span><span class="p">)</span>

<span class="c1"># f() will only be called if the event loop is started.</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
<p>If we want a task to run every X seconds repeatedly, we can use <cite>twisted.internet.task.LoopingCall</cite>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>

<span class="n">loopTimes</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">failInTheEnd</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">_loopCounter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">runEverySecond</span><span class="p">():</span>
    <span class="sd">"""</span>
<span class="sd">    Called at ever loop interval.</span>
<span class="sd">    """</span>
    <span class="k">global</span> <span class="n">_loopCounter</span>

    <span class="k">if</span> <span class="n">_loopCounter</span> <span class="o">&lt;</span> <span class="n">loopTimes</span><span class="p">:</span>
        <span class="n">_loopCounter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'A new second has passed.'</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">failInTheEnd</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Failure during loop execution.'</span><span class="p">)</span>

    <span class="c1"># We looped enough times.</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="k">return</span>


<span class="k">def</span> <span class="nf">cbLoopDone</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Called when loop was stopped with success.</span>
<span class="sd">    """</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Loop done."</span><span class="p">)</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">ebLoopFailed</span><span class="p">(</span><span class="n">failure</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Called when loop execution failed.</span>
<span class="sd">    """</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">failure</span><span class="o">.</span><span class="n">getBriefTraceback</span><span class="p">())</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="n">loop</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">LoopingCall</span><span class="p">(</span><span class="n">runEverySecond</span><span class="p">)</span>

<span class="c1"># Start looping every 1 second.</span>
<span class="n">loopDeferred</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># Add callbacks for stop and failure.</span>
<span class="n">loopDeferred</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">cbLoopDone</span><span class="p">)</span>
<span class="n">loopDeferred</span><span class="o">.</span><span class="n">addErrback</span><span class="p">(</span><span class="n">ebLoopFailed</span><span class="p">)</span>

<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
<p>If we want to cancel a task that we've scheduled:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"I'll never run."</span><span class="p">)</span>

<span class="n">callID</span> <span class="o">=</span> <span class="n">reactor</span><span class="o">.</span><span class="n">callLater</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="n">callID</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
<p>As with all reactor-based code, in order for scheduling to work the reactor must be started using <tt class="docutils literal">reactor.run()</tt> .</p>
<div class="section" id="see-also">
<h2><a class="toc-backref" href="#id1">See also</a></h2>
<ol class="arabic simple">
<li><cite>Timing out Deferreds &lt;core-howto-defer-deferreds-timeouts&gt;</cite></li>
</ol>

</div>

        </div>
        </div>
        </div>
<div class="sphinxsidebar">
<div class="sphinxsidebarwrapper">
<div class="toc" id="">
<p class="topic-title">Table Of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#see-also" id="id1">See also</a></li>
</ul>
</div>
</div>
</div>    </div>

    </section>

        <div id="footer"><hr>
                <div> </div>
                <p class="left2">
        Copyright 2021, Twisted Matrix Labs. Ver 21.2.0. Built on 2021-02-28.<br />
        Site design<br />
        By <a href="http://huw.ugbox.net/">huw.wilkins.</a>

                </p>
                <p class="right"></p>
        </div>


</body>
</html>